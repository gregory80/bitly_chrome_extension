<!DOCTYPE HTML>
<html>

<!--
    http://unlicense.org/
    author: gregory tomlinson
-->

<!-- MIME TYPE Guidlines and references: http://hixie.ch/advocacy/xhtml -->
    <head>
        <title>bit.ly Chrome Extension Metrics Summary</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="keywords" content="awesome" />
        <meta name="description" content="" />
        <link rel="stylesheet" href="css/basic.css" type="text/css" charset="utf-8" />
        <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />
        <link rel="stylesheet" href="css/metrics.css" type="text/css" charset="utf-8" />                
        
    </head>
    <body>
        <div id="container">

            <div id="top">
                <div id="blueBanner">
                    <ul class="ext_nav_list">
                        <li><a class="openOptions" href="/options.html">Settings</a></li>
                        <li><a class="openTrending" href="">Currently Trending</a></li>
                        <li><a class="openAnalyze" href="/metrics.html">Analyze</a></li>                            
                    </ul>
                
                </div>
                
                <div id="logo">
                    <a href="options.html"><img src="s/graphics/bitly_logo.png" alt="" border="0"width="280px" height="47px"  /></a>
                </div>
            </div> <!-- end #top -->
            
            <div id="middle">
                hello world
            </div> <!-- END #middle -->
        
            <div id="bottom">

            </div> <!-- end #bottom -->
            
        </div> <!-- end #container -->
    
<script type="text/javascript" charset="utf-8" src="js/libs/fastFrag.js"></script>
<script type="text/javascript" charset="utf-8" src="js/jquery-1.4.4.js"></script>
<script type="text/javascript" charset="utf-8">
    //user_clicks
    
    (function() {
        var bg = chrome.extension.getBackgroundPage(), 
            context, total_h=350, total_w=900, user_click_data=[];
        
        function init() {
            $(function(){
                $(document.body).addClass("page_loaded");
            });
            $('#middle').append( fastFrag.create(build_canvas(total_w,total_h) ) );
            bg.bitly.user_clicks(30,function(jo) {
                console.log(jo, "metrics for user");
                var max_clicks=0;
                for(var i=0; i<jo.clicks.length; i++) {
                    max_clicks=Math.max(max_clicks,jo.clicks[i].clicks)
                }
                user_click_data=jo.clicks;
                // console.log("max_clicks", max_clicks)
                // paint_graph( jo.clicks.slice(14).reverse(), 14, max_clicks, "rgba(192,192,192,0.4)" );
                paint_graph( jo.clicks.reverse(), jo.clicks.length, max_clicks, "rgba(107,175,240,0.5)" );

            });
            var can_tag = document.getElementById("metrics_summary_canvas");
            console.log(can_tag.getBoundingClientRect())
            context=can_tag.getContext('2d')
            console.log(context)
        }
        
        function paint_graph( click_data, days, max_clicks, fill_color ) {
            console.log("days", days);
            
            /*
                {
                    x:0,y:0,
                    total:function(){return canvas_total_height-(clicks*scale_offset);}
                }
                scale_offset=Math.round(total_h/max_clicks);
            */
            // todo
            // setup obejcts
            // start loopin / painting using 'framerate' speed aka not a for loop directly
            context.beginPath();
            context.lineJoin="round";
            context.lineWidth=2;
            context.fillStyle=fill_color
            context.moveTo(0,total_h);
            var offsetter=Math.round(total_w/days),
                top_off=Math.round(total_h/max_clicks);
            for(var i=0; i<click_data.length; i++) {
                context.lineTo(i*offsetter,total_h-(click_data[i].clicks*top_off));
            }
            context.lineTo((days-1)*offsetter,total_h);
            context.closePath(); 
            context.stroke();
            // context.closePath();
            context.fill();
            

            
            console.log("max clicks for period", max_clicks)
        }
        
        function loop() {
            
        }
        
        function build_canvas(w,h) {
            return {
                content :[{
                    type : 'canvas',
                    id : 'metrics_summary_canvas',
                    attr : {
                        'width' : w,
                        'height' : h
                    }                    
                },{
                    content : {
                        type : "ul",
                        content : [{
                            type : "a",
                            css : "",
                            content : "last 30 days",
                            attr : {
                                href : "#"
                            }
                        }, {
                            type : "a",
                            css : "myClass",
                            content : "Weekly Overlay view",
                            attr : {
                                href : "#"
                            }
                        }]
                    }
                }]
            }
        }
        
        
        init();
        
    })();
</script>
      
    </body>
</html>
